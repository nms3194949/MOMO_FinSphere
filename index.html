<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>MOMO財商智庫｜月配息 × AI智能決策系統</title>
<meta name="description" content="MOMO財商智庫：月配息 × 資產增值 × AI智能決策。基金研究、回撤策略、權證篩選與智能工具一站完成。">
<meta property="og:title" content="MOMO財商智庫｜月配息 × AI智能決策系統">
<meta property="og:description" content="基金研究、回撤策略、權證篩選與智能工具一站完成。">
<meta property="og:type" content="website">
<meta property="og:url" content="https://your-domain.example/">
<meta property="og:image" content="https://your-domain.example/og-cover.jpg">
<meta name="theme-color" content="#0A1221" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;700;800&display=swap" rel="stylesheet" />
<style>
:root{ --deep:#0A1221; --card:#0C152A; --ink:#EDEFF5; --muted:#AAB2BF; --gold:#C9A227; --gold-soft:#E9D18A; --line:rgba(233,209,138,.28); --gold-grad:linear-gradient(90deg,#F9E27C 0%,#D9B84B 50%,#B88A1E 100%); --accent:#2D7A77; }
*{box-sizing:border-box}
html,body{margin:0}
body{background:var(--deep);color:var(--ink);font-family:"Noto Sans TC",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
a{color:inherit;text-decoration:none}

/* Layout base */
.wrap{max-width:1120px;margin:0 auto;padding:16px}
.header{display:flex;align-items:center;justify-content:space-between;padding:12px 0}
.logo{display:flex;align-items:center;gap:10px;font-weight:800}
.logo::before{content:"";width:28px;height:28px;border-radius:50%;background:radial-gradient(120% 120% at 20% 20%, var(--gold) 0%, var(--gold-soft) 45%, transparent 46%), #1a1f2b;border:1px solid var(--line)}
.nav{display:flex;gap:10px;flex-wrap:nowrap;overflow:auto;padding-bottom:4px;scroll-snap-type:x mandatory}
.nav a{padding:10px 14px;border-radius:999px;border:1px solid var(--line);background:linear-gradient(180deg,#0e172b,#111a2f);font-weight:600;scroll-snap-align:start;flex:0 0 auto}
.nav a[aria-current="page"], .nav a:hover{background:var(--gold-grad);color:#0A1221}
.section{margin-top:24px}
.card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px}
.btn{display:inline-block;padding:10px 16px;border-radius:10px;font-weight:600;transition:.2s}
.btn-gold{background:var(--gold-grad);color:#0A1221;border:none}
.btn-gold:hover{filter:brightness(1.1)}
.footer{margin-top:40px;color:var(--muted);font-size:13px;text-align:center;border-top:1px solid var(--line);padding:20px 0}

/* Hero */
.hero{border:1px solid var(--line);border-radius:16px;padding:24px;background:linear-gradient(120deg,rgba(201,162,39,.15),rgba(45,122,119,.12) 40%, transparent 100%), #0B1222;text-align:center}
.hero h1{margin:6px 0 8px;font-size:clamp(22px, 2.6vw, 32px);background:var(--gold-grad);-webkit-background-clip:text;color:transparent}
.hero p{color:var(--muted);margin:0}
.hero small{color:var(--gold-soft)}
.hero .btn-line{display:inline-block;margin-top:18px;padding:12px 20px;border-radius:999px;font-weight:800;background:var(--gold-grad);color:#0A1221;border:none;box-shadow:0 6px 14px rgba(0,0,0,.35);transition:filter .2s}
.hero .btn-line:hover{filter:brightness(1.15)}

/* Tools grid */
.tools{display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(300px,1fr))}

/* IG */
#ig-section{margin-top:60px;padding:40px 0;background:#0A1221}
#ig-section h2{font-size:22px;font-weight:700;margin:0 0 18px 0;color:var(--gold-soft)}
.embedsocial-hashtag{border:1px solid rgba(201,162,39,0.2);border-radius:18px;background:#0C152A;box-shadow:0 6px 18px rgba(0,0,0,.35);padding:18px;min-height:420px;display:grid;place-items:center}
@media(max-width:768px){.embedsocial-hashtag{padding:10px}}

/* Strategy gauges */
#strategy .bar-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
#strategy .bar-title{
  font-size:16px;font-weight:800;letter-spacing:.5px;margin:0;padding-bottom:6px;
  border-bottom:1px solid var(--gold-soft);
  background:linear-gradient(90deg,#F9E27C 0%,#D9B84B 25%,#B88A1E 50%,#D9B84B 75%,#F9E27C 100%);
  background-size:200% auto; -webkit-background-clip:text; color:transparent; 
  animation:goldflow 4s linear infinite;
}
@keyframes goldflow{0%{background-position:0% 50%}100%{background-position:200% 50%}}

#strategy .row{display:flex;gap:16px;flex-wrap:wrap}
.card2{background:var(--card);border:1px solid var(--line);border-radius:16px;width:calc(50% - 8px);min-width:300px;padding:18px 16px 20px;box-shadow:0 10px 22px rgba(0,0,0,.45);display:flex;flex-direction:column;gap:18px}
.card2 h3{margin:0 0 4px;font-size:20px;color:var(--gold-soft)}
.block{display:flex;flex-direction:column;gap:6px;padding-bottom:10px;border-bottom:1px solid rgba(255,255,255,.08)}
.block:last-child{padding-bottom:0;border-bottom:0}
.block .label{font-size:13.5px;font-weight:800;color:rgba(233,209,138,.9)}
.gauge{width:100%}
.readout{align-self:center;font-size:17px;font-weight:800;border:1px solid var(--gold-soft);border-radius:4px;padding:3px 10px;color:var(--ink)}
.tick-label{font-size:9.5px;font-weight:700;fill:var(--ink)}

/* 呼吸：淡金 ↔ 白（用在 SVG 的第二個 stop） */
@keyframes breatheGoldWhite{0%{stop-color:#FFFFFF;stop-opacity:.9}50%{stop-color:#E9D18A;stop-opacity:.8}100%{stop-color:#FFFFFF;stop-opacity:.9}}
.gradient-stop-animated{animation:breatheGoldWhite 2.2s ease-in-out infinite alternate}

@media(max-width:820px){.card2{width:100%}}
@media (prefers-reduced-motion: reduce){.gradient-stop-animated{animation:none}}

/* Mobile fixed CTA */
.cta-fixed{position:fixed;left:0;right:0;bottom:0;z-index:1000;background:rgba(10,18,33,.92);backdrop-filter:blur(8px);border-top:1px solid var(--line);padding:12px env(safe-area-inset-right) calc(12px + env(safe-area-inset-bottom)) env(safe-area-inset-left);display:none}
.cta-fixed .btn-line{display:block;text-align:center;padding:14px 18px;border-radius:999px;background:var(--gold-grad);color:#0A1221;font-weight:800;box-shadow:0 8px 16px rgba(0,0,0,.35)}
@media(max-width:768px){.cta-fixed{display:block} body.has-cta{padding-bottom:84px}}

/* Calculator */
#calc .grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}
#calc .panel{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px;position:relative}
#calc h2{margin:0 0 6px;font-size:18px;color:var(--gold-soft)}
#calc p.desc{margin:0 0 12px;color:var(--muted)}
#calc label{display:block;font-weight:800;font-size:13px;color:rgba(233,209,138,.9);margin-bottom:6px}
#calc input[type="number"]{width:100%;background:#0e162a;color:var(--ink);border:1px solid var(--line);border-radius:10px;padding:10px 12px;font-size:16px}
#calc .row{display:flex;align-items:center;gap:10px}
#calc input[type="range"]{width:100%}
#calc .out{display:flex;flex-direction:column;gap:8px}
#calc .out .kv{display:flex;align-items:center;justify-content:space-between;border:1px solid var(--line);border-radius:12px;padding:10px 12px;background:#0b1427}
#calc .out .k{font-size:13px;color:rgba(233,209,138,.9);font-weight:800}
#calc .out .v{font-size:18px;font-weight:800}
#calc .mini{font-size:12px;color:var(--muted)}
#calc .pill{border:1px solid var(--line);padding:4px 8px;border-radius:999px;font-size:12px;color:var(--muted)}
#calc .ctrls{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
#calc .out-row{display:flex;gap:10px;flex-wrap:wrap}
#calc .out-row .kv{flex:1;min-width:240px}
#calc .actions{position:absolute;top:16px;right:16px;display:flex;gap:8px}
.btn-outline{background:transparent;border:1px solid var(--gold-soft);color:var(--gold-soft);padding:6px 10px;border-radius:10px}
.btn-outline:hover{background:rgba(233,209,138,.08)}
</style>
</head>
<body>

  <main id="main" class="wrap" role="main">
    <header class="header" role="banner">
      <div class="logo">MOMO財商智庫</div>
      <nav class="nav" role="navigation" aria-label="主選單">
        <a href="#" aria-current="page">首頁</a>
        <a href="#strategy">策略進度</a>
        <a href="#calc">互動試算</a>
        <a href="#tools">智能工具</a>
        <a href="#ig-section">IG 精選</a>
      </nav>
    </header>

    <section class="hero" aria-labelledby="hero-title">
      <small>雙贏策略品牌中心</small>
      <h1 id="hero-title">MOMO財商智庫｜月配息 × AI智能決策系統</h1>
      <p>整合基金智能分析、虛擬貨幣策略與權證分析，打造全方位財商系統。</p>
      <a href="https://lin.ee/hgGTE8d" target="_blank" rel="noopener noreferrer" class="btn-line" aria-label="加入 MOMO 財商智庫官方 LINE">加入官方 LINE ▶</a>
    </section>

    <!-- ====== 策略進度（兩塊橫排，上下成對） ====== -->
    <section id="strategy" class="section" aria-labelledby="strategy-title">
      <div class="bar-header"><h2 id="strategy-title" class="bar-title">MOMO「雙贏巔峰」策略（進行中）</h2></div>
      <div class="row">
        <div class="card2">
          <h3>資產狀況</h3>
          <div class="block" data-key="principal" data-min="0" data-max="10000000" data-step="1000000" data-unit="M">
            <div class="label">基金規模</div>
            <div class="gauge" id="g-principal"></div>
            <div class="readout" id="r-principal"></div>
          </div>
          <div class="block" data-key="monthly" data-min="0" data-max="200000" data-step="20000" data-unit="K">
            <div class="label">月配息金額</div>
            <div class="gauge" id="g-monthly"></div>
            <div class="readout" id="r-monthly"></div>
          </div>
        </div>
        <div class="card2">
          <h3>收益率</h3>
          <div class="block" data-key="dist" data-min="0" data-max="30" data-step="5" data-unit="%">
            <div class="label">配息率(%)</div>
            <div class="gauge" id="g-dist"></div>
            <div class="readout" id="r-dist"></div>
          </div>
          <div class="block" data-key="annual" data-min="0" data-max="50" data-step="5" data-unit="%">
            <div class="label">預估年均成長率(%)</div>
            <div class="gauge" id="g-annual"></div>
            <div class="readout" id="r-annual"></div>
          </div>
        </div>
      </div>
      <div id="notice" role="status" aria-live="polite" style="margin-top:8px;color:#E9D18A"></div>
    </section>

    <!-- ===== 互動小工具：配息率 ↔ 年均成長試算 ===== -->
    <section id="calc" class="section" aria-labelledby="calc-title">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:6px">
        <h2 id="calc-title">配息許願</h2>
        <button id="btn-save-png" class="btn-outline" type="button" aria-label="匯出目前互動試算為 PNG">匯出 PNG</button>
      </div>
      <p class="desc">輸入本金，調整「配息率」拉桿，系統會即時計算：每月配息、<strong>每年的本金成長率</strong></p>
      <div class="grid" id="calc-capture">
        <div class="panel" aria-labelledby="in-title">
          <h3 id="in-title" style="margin:0 0 10px">輸入</h3>
          <label for="amt">投入本金（元）</label>
          <input id="amt" type="number" inputmode="numeric" min="0" step="1000" value="1000000" />
          <div class="row" style="margin-top:14px">
            <label for="distRange" style="margin:0">配息率（%）</label>
            <span id="distNow" class="pill" aria-live="polite">8%</span>
          </div>
          <input id="distRange" type="range" min="0" max="17" step="1" value="8" aria-valuemin="0" aria-valuemax="17" aria-valuenow="8" aria-label="配息率"/>
          <div class="mini">範圍 0–17%，步進 1%｜快捷：
            <button type="button" id="dist5"  class="pill" aria-label="配息率設為5%">5%</button>
            <button type="button" id="dist10" class="pill" aria-label="配息率設為10%">10%</button>
            <button type="button" id="dist15" class="pill" aria-label="配息率設為15%">15%</button>
          </div>
        </div>

        <div class="panel" aria-labelledby="out-title">
          <h3 id="out-title" style="margin:0 0 10px">結果</h3>
          <div class="out">
            <div class="kv"><div class="k">預估月配息</div><div class="v" id="out-monthly">—</div></div>
            <div class="kv"><div class="k">每年本金成長率</div><div class="v" id="out-grow">—</div></div>
            <div class="kv"><div class="k">三年後本金（不含配息）</div><div class="v" id="out-3y">—</div></div>
            <div class="kv"><div class="k">三年總領配息</div><div class="v" id="out-3y-div">—</div></div>
            <div class="out-row">
              <div class="kv"><div class="k">三年總報酬（本金+配息）</div><div class="v" id="out-total">—</div></div>
              <div class="kv"><div class="k">三年累積報酬率</div><div class="v" id="out-total-rate">—</div></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ===== 智能工具 ===== -->
    <section class="section" id="tools" aria-labelledby="tools-title">
      <h2 id="tools-title" style="margin-bottom:16px;color:var(--gold-soft)">智能工具</h2>
      <div class="tools">
        <div class="card"><h3>BTC/ETH進場策略</h3><p style="color:var(--muted)">即時監控，加密市場回撤與進出場策略。</p><a class="btn btn-gold" href="https://nms3194949.github.io/BTC_PC/" target="_blank" rel="noopener noreferrer">開啟</a></div>
        <div class="card"><h3>基金AI智能分析</h3><p style="color:var(--muted)">基金投組試算，AI最佳化分析。</p><a class="btn btn-gold" href="https://nms3194949.github.io/CAGR_Mobile/" target="_blank" rel="noopener noreferrer">開啟</a></div>
        <div class="card"><h3>權證篩選API</h3><p style="color:var(--muted)">串接權證API，一鍵篩選權證。</p><a class="btn btn-gold" href="https://warrant-render-proxy-1.onrender.com/" target="_blank" rel="noopener noreferrer">開啟</a></div>
      </div>
    </section>

    <!-- ===== IG 最新貼文 ===== -->
    <section id="ig-section" aria-labelledby="ig-title">
      <h2 id="ig-title">最新 IG 精選</h2>
      <div class="embedsocial-hashtag" data-ref="42032a17319b8cd123ca39bbcf94096c57c120b0">
        <a class="feed-powered-by-es feed-powered-by-es-feed-img es-widget-branding" href="https://embedsocial.com/social-media-aggregator/" target="_blank" title="Instagram widget">
          <img src="https://embedsocial.com/cdn/icon/embedsocial-logo.webp" alt="EmbedSocial">
          <div class="es-widget-branding-text">Instagram widget</div>
        </a>
      </div>
    </section>

    <footer class="footer">© MOMO財商智庫｜投資有風險，基金與加密資產無保證報酬，淨值可能因市場波動而變化，請依自身風險承受度謹慎評估。</footer>
  </main>

  <!-- Mobile 固定 CTA -->
  <div class="cta-fixed" role="region" aria-label="加入官方 LINE">
    <a href="https://lin.ee/hgGTE8d" target="_blank" rel="noopener noreferrer" class="btn-line" aria-label="立即加入 MOMO 財商智庫官方 LINE">加入官方 LINE ▶</a>
  </div>

  <!-- html2canvas for PNG export -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js" crossorigin="anonymous"></script>

  <!-- JS：儀表、URL 覆寫、IG、計算器、PNG 匯出 -->
  <script>
  /* Strategy defaults */
  const MOMO_PROGRESS_CONFIG = { monthly:75658, principal:6277633, dist:14, annual:45 };
  function readQueryOverrides(){ const p=new URLSearchParams(location.search); const normalize=s=>s.replace(/[\,\s]/g,'').replace(/[０-９]/g,d=>String.fromCharCode(d.charCodeAt(0)-0xFEE0)); const o={}; ['monthly','principal','dist','annual'].forEach(k=>{ if(p.has(k)&&p.get(k)!==''){ const v=Number(normalize(p.get(k))); if(!Number.isNaN(v)) o[k]=v; } }); return o; }
  const nfTW=new Intl.NumberFormat('zh-TW');
  function clamp(v,min,max){return Math.min(max,Math.max(min,v))}
  function fmtAxis(v,u){ if(u=='%') return Math.round(v); if(u=='M') return (v/1e6).toFixed(0)+'M'; if(u=='K') return (v/1e3).toFixed(0)+'K'; return nfTW.format(v); }
  function fmtRead(v,u){return u=='%'?Number(v).toFixed(2)+'%':'＄'+nfTW.format(Math.round(v))+' 元'}
  function uniqueId(prefix='id'){return `${prefix}-${Math.random().toString(36).slice(2,9)}`}
  function autoStep(min,max,baseStep,containerWidth){ const ticks=(max-min)/baseStep; if(containerWidth<320&&ticks>8) return baseStep*2; if(containerWidth<280&&ticks>6) return baseStep*3; return baseStep; }

  function drawGauge(el,{min,max,step,unit,value,breath=false}){
    const parentWidth=Math.max(260,el.clientWidth||300);
    const W=parentWidth,H=64,BH=14,X0=10,WB=W-2*X0,Y=42,TYO=10,TL=6;
    const stepUsed=autoStep(min,max,step,parentWidth);
    const svg=document.createElementNS('http://www.w3.org/2000/svg','svg');
    svg.setAttribute('viewBox',`0 0 ${W} ${H}`); el.innerHTML=''; el.appendChild(svg);

    let gradId;
    if(breath){
      gradId=uniqueId('goldGrad');
      const defs=document.createElementNS('http://www.w3.org/2000/svg','defs');
      const g=document.createElementNS('http://www.w3.org/2000/svg','linearGradient');
      g.setAttribute('id',gradId); g.setAttribute('x1','0%'); g.setAttribute('y1','0%'); g.setAttribute('x2','100%'); g.setAttribute('y2','0%');
      const s1=document.createElementNS('http://www.w3.org/2000/svg','stop'); s1.setAttribute('offset','0%'); s1.setAttribute('style','stop-color:#E9D18A;stop-opacity:1');
      const s2=document.createElementNS('http://www.w3.org/2000/svg','stop'); s2.setAttribute('offset','100%'); s2.setAttribute('class','gradient-stop-animated');
      g.append(s1,s2); defs.append(g); svg.append(defs);
    }

    function valueToX(v){ const t=(clamp(v,min,max)-min)/(max-min||1); return X0+t*WB; }

    const lblStep=stepUsed*2;
    for(let v=min; v<=max; v+=stepUsed){
      const x=valueToX(v);
      const major=(Math.abs(((v-min)%lblStep))<1e-6)||v===min||v===max;
      const ln=document.createElementNS('http://www.w3.org/2000/svg','line');
      ln.setAttribute('x1',x); ln.setAttribute('y1',Y-BH/2-TYO);
      ln.setAttribute('x2',x); ln.setAttribute('y2',Y-BH/2-TYO+TL);
      ln.setAttribute('stroke',major?'#E9D18A':'rgba(233,209,138,.7)');
      ln.setAttribute('stroke-width',major?'2.6':'1'); svg.append(ln);
      if(major){
        const t=document.createElementNS('http://www.w3.org/2000/svg','text');
        t.setAttribute('x',x); t.setAttribute('y',Y-BH/2-TYO-3);
        t.setAttribute('text-anchor','middle'); t.setAttribute('class','tick-label');
        t.textContent=fmtAxis(v,unit); svg.append(t);
      }
    }

    const tr=document.createElementNS('http://www.w3.org/2000/svg','rect');
    tr.setAttribute('x',X0); tr.setAttribute('y',Y-BH/2);
    tr.setAttribute('width',WB); tr.setAttribute('height',BH);
    tr.setAttribute('rx',BH/2); tr.setAttribute('fill','#1a2337'); svg.append(tr);

    const pr=document.createElementNS('http://www.w3.org/2000/svg','rect');
    pr.setAttribute('x',X0); pr.setAttribute('y',Y-BH/2);
    pr.setAttribute('height',BH); pr.setAttribute('rx',BH/2);
    pr.setAttribute('fill',breath?`url(#${gradId})`:'#E9D18A');
    pr.style.transition='width .5s ease-out'; svg.append(pr);
    pr.setAttribute('width',Math.max(0,valueToX(value)-X0));
    return nv=>pr.setAttribute('width',Math.max(0,valueToX(nv)-X0));
  }

  const state={...MOMO_PROGRESS_CONFIG,...readQueryOverrides()};
  function showNotice(msg){ const n=document.getElementById('notice'); if(n) n.textContent=msg; }
  function mountBlock(blockEl){
    const key=blockEl.dataset.key; const min=+blockEl.dataset.min; const max=+blockEl.dataset.max;
    const step=+blockEl.dataset.step; const unit=blockEl.dataset.unit;
    const gaugeEl=blockEl.querySelector('.gauge'); const readEl=blockEl.querySelector('.readout');
    const initVal=clamp(Number(state[key]??0),min,max);
    let updateWidth=drawGauge(gaugeEl,{min,max,step,unit,value:initVal,breath:(key==='monthly')});
    blockEl._value=initVal; readEl.textContent=fmtRead(initVal,unit);
    blockEl._update=(v)=>{ const nv=clamp(v,min,max); blockEl._value=nv; updateWidth(nv); readEl.textContent=fmtRead(nv,unit); };
    let rafId=null; const ro=new ResizeObserver(()=>{
      if(rafId) cancelAnimationFrame(rafId);
      rafId=requestAnimationFrame(()=>{
        const curr=blockEl._value??initVal;
        updateWidth=drawGauge(gaugeEl,{min,max,step,unit,value:curr,breath:(key==='monthly')});
        readEl.textContent=fmtRead(curr,unit);
      });
    });
    ro.observe(gaugeEl); blockEl._destroy=()=>ro.disconnect();
  }
  try{ document.querySelectorAll('.block').forEach(mountBlock); }catch(e){ showNotice('參數格式有誤，已使用預設值。'); }

  // Mobile safe space for CTA
  if (matchMedia('(max-width: 768px)').matches) { document.body.classList.add('has-cta'); }

  // IG widget
  (function(d,s,id){var js;if(d.getElementById(id))return;js=d.createElement(s);js.id=id;js.src='https://embedsocial.com/cdn/ht.js';d.getElementsByTagName('head')[0].appendChild(js);})(document,'script','EmbedSocialHashtagScript');

  // Calculator logic (CAGR baseline & slope can be overridden by URL)
  (function(){
    const q=new URLSearchParams(location.search);
    const CAGR_BASE=Number(q.get('cagr'))||27.29; // % at dist=0
    const SLOPE=Number(q.get('slope'))||1;        // each +1% dist -> -SLOPE% growth
    const $=id=>document.getElementById(id);
    const nf=new Intl.NumberFormat('zh-TW');
    const pct=x=>(Math.round(x*100)/100).toFixed(2)+'%';
    const money=x=>'＄'+nf.format(Math.round(x));
    const amt=$('amt'),range=$('distRange'),distNow=$('distNow');
    const outM=$('out-monthly'),outG=$('out-grow'),out3y=$('out-3y'),out3yDiv=$('out-3y-div'),outTotal=$('out-total'),outRate=$('out-total-rate');

    function growthByDist(d){ return Math.max(0, CAGR_BASE - SLOPE*d); }

    function calc(){
      const principal=Math.max(0,Number(amt?.value||0));
      const d=Math.max(0,Math.min(Number(range?.max||20),Number(range?.value||0)));
      if(distNow) distNow.textContent=d+'%';
      if(range) range.setAttribute('aria-valuenow',String(d));

      const monthly=principal*(d/100)/12;           // 月配息
      const grow=growthByDist(d);                    // 每年本金成長率(%)
      const after3y=principal*Math.pow(1+grow/100,3);// 三年後本金(不含息)
      const div3y=principal*(d/100)*3;               // 三年總領配息(不再投)
      const total=after3y+div3y;                     // 三年總報酬
      const totalRate=(total/principal-1)*100;       // 三年累積報酬率

      if(outM) outM.textContent=money(monthly);
      if(outG) outG.textContent=pct(grow);
      if(out3y) out3y.textContent=money(after3y);
      if(out3yDiv) out3yDiv.textContent=money(div3y);
      if(outTotal) outTotal.textContent=money(total);
      if(outRate) outRate.textContent=pct(totalRate);
    }

    function setDist(v){
      const min=Number(range?.min||0), max=Number(range?.max||20);
      const clamped=Math.max(min,Math.min(max,Number(v)));
      if(range){ range.value=String(clamped); }
      calc();
    }

    // 快捷鍵 5 / 10 / 15
    $('dist5')?.addEventListener('click', ()=>setDist(5));
    $('dist10')?.addEventListener('click', ()=>setDist(10));
    $('dist15')?.addEventListener('click', ()=>setDist(15));

    ['input','change'].forEach(ev=>{ amt?.addEventListener(ev,calc); range?.addEventListener(ev,calc); });
    calc();
  })();

  // Export PNG: capture input + result panels
  (function(){
    const btn = document.getElementById('btn-save-png');
    const target = document.getElementById('calc-capture');
    if(!btn || !target) return;

    function downloadBlob(blob, filename){
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href=url; a.download=filename; document.body.appendChild(a); a.click();
      setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 250);
    }

    btn.addEventListener('click', async ()=>{
      const prev = {boxShadow: target.style.boxShadow, padding: target.style.padding, bg: target.style.background};
      target.style.boxShadow='0 0 0 1px rgba(233,209,138,.18)';
      target.style.padding='8px';
      target.style.background='transparent';
      try{
        const canvas = await html2canvas(target, {backgroundColor:'#0A1221', scale: Math.min(2, window.devicePixelRatio || 1), useCORS:true, logging:false});
        canvas.toBlob(blob=>{ if(blob) downloadBlob(blob, `MOMO_calc_${new Date().toISOString().slice(0,19).replace(/[:T]/g,'-')}.png`); });
      }catch(e){ alert('匯出失敗，請再試一次'); }
      finally{
        target.style.boxShadow=prev.boxShadow; target.style.padding=prev.padding; target.style.background=prev.bg;
      }
    });
  })();
  </script>
</body>
</html>
